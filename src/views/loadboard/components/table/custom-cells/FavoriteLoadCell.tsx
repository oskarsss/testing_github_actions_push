import { useStableArray } from '@/hooks/useStable';
import { useAppDispatch, useAppSelector } from '@/store/hooks';
import { loadboardFavoritesLoads } from '@/store/loadboard/selectors';
import { LoadboardActions } from '@/store/loadboard/slice';
import { IconButton, Stack, createSvgIcon } from '@mui/material';
import React, { memo, useMemo } from 'react';

type Props = { resultId: string };

const FavoriteIcon = createSvgIcon(
    <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 16 16"
        fill="none"
    >
        <path
            d="M7.51266 2.94076C7.667 2.59451 7.74417 2.42138 7.85163 2.36807C7.94497 2.32175 8.05461 2.32175 8.14795 2.36807C8.25541 2.42138 8.33258 2.59451 8.48692 2.94076L9.71628 5.69872C9.76191 5.80108 9.78472 5.85226 9.82002 5.89145C9.85126 5.92613 9.88943 5.95387 9.93207 5.97286C9.98025 5.99432 10.036 6.0002 10.1474 6.01196L13.1503 6.3289C13.5273 6.36869 13.7158 6.38858 13.7997 6.47431C13.8726 6.54877 13.9065 6.65304 13.8913 6.75612C13.8738 6.8748 13.733 7.00169 13.4514 7.25548L11.2083 9.27692C11.125 9.35195 11.0834 9.38946 11.057 9.43515C11.0337 9.47557 11.0191 9.52044 11.0142 9.56686C11.0087 9.61932 11.0203 9.67414 11.0436 9.78377L11.6701 12.7376C11.7488 13.1084 11.7881 13.2939 11.7325 13.4002C11.6842 13.4925 11.5955 13.5569 11.4928 13.5743C11.3745 13.5944 11.2103 13.4997 10.8819 13.3103L8.26626 11.8016C8.16918 11.7456 8.12064 11.7176 8.06904 11.7067C8.02338 11.697 7.9762 11.697 7.93054 11.7067C7.87894 11.7176 7.8304 11.7456 7.73332 11.8016L5.11767 13.3103C4.78928 13.4997 4.62509 13.5944 4.50681 13.5743C4.40407 13.5569 4.31538 13.4925 4.26709 13.4002C4.21149 13.2939 4.25082 13.1084 4.32948 12.7376L4.95599 9.78377C4.97924 9.67414 4.99087 9.61932 4.98534 9.56686C4.98046 9.52044 4.96588 9.47557 4.94255 9.43515C4.91618 9.38946 4.87455 9.35195 4.7913 9.27692L2.54823 7.25547C2.26662 7.00169 2.12581 6.8748 2.10831 6.75612C2.0931 6.65304 2.12698 6.54877 2.19987 6.47431C2.28379 6.38858 2.47229 6.36869 2.84929 6.3289L5.85215 6.01196C5.9636 6.0002 6.01933 5.99432 6.06751 5.97286C6.11015 5.95387 6.14832 5.92613 6.17956 5.89145C6.21486 5.85226 6.23767 5.80108 6.2833 5.69872L7.51266 2.94076Z"
            stroke="#6B7789"
            strokeLinecap="round"
            strokeLinejoin="round"
        />
    </svg>,
    'FavoriteIcon'
);

const FilledFavoriteIcon = createSvgIcon(
    <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 16 16"
        fill="none"
    >
        <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M7.55539 1.77088C7.83542 1.63193 8.16432 1.63193 8.44435 1.77088C8.69139 1.89346 8.82024 2.10886 8.88211 2.21974C8.94902 2.33966 9.01755 2.49348 9.08604 2.64719C9.08933 2.65458 9.09262 2.66197 9.09591 2.66935L10.294 5.35706L13.2445 5.66847C13.4118 5.6861 13.5793 5.70375 13.714 5.73033C13.8386 5.7549 14.0833 5.81088 14.2762 6.00796C14.4949 6.23134 14.5965 6.54414 14.5509 6.85341C14.5106 7.12624 14.3456 7.31534 14.2593 7.40845C14.1659 7.50913 14.0408 7.62184 13.9158 7.73447L11.7118 9.72068L12.3274 12.623C12.3623 12.7876 12.3973 12.9524 12.4136 13.0887C12.4288 13.2148 12.4511 13.4648 12.3233 13.7091C12.1784 13.9861 11.9124 14.1795 11.6041 14.2317C11.3322 14.2777 11.1014 14.1792 10.9862 14.1258C10.8615 14.0681 10.7157 13.984 10.57 13.8999L7.99987 12.4175L5.42977 13.8999C5.28403 13.984 5.13819 14.0681 5.01358 14.1258C4.89836 14.1792 4.66751 14.2777 4.3956 14.2317C4.08738 14.1795 3.82129 13.9861 3.67641 13.7091C3.5486 13.4648 3.57097 13.2148 3.58609 13.0887C3.60245 12.9523 3.63741 12.7876 3.67236 12.623L4.28795 9.72068L2.102 7.75072C2.09599 7.74531 2.08998 7.73989 2.08397 7.73448C1.95895 7.62184 1.83384 7.50914 1.74047 7.40845C1.65413 7.31534 1.48909 7.12624 1.44885 6.85341C1.40324 6.54414 1.50487 6.23134 1.72356 6.00796C1.91648 5.81088 2.16115 5.7549 2.28572 5.73033C2.42044 5.70375 2.5879 5.6861 2.75525 5.66847C2.7633 5.66762 2.77135 5.66677 2.77939 5.66593L5.70578 5.35706L6.90383 2.66935C6.90712 2.66196 6.91041 2.65457 6.9137 2.64718C6.98219 2.49347 7.05072 2.33966 7.11763 2.21974C7.17949 2.10886 7.30834 1.89346 7.55539 1.77088Z"
            fill="#0A43E1"
        />
    </svg>,
    'FilledFavoriteIcon'
);

function FavoriteLoadCell({ resultId }: Props) {
    const dispatch = useAppDispatch();
    const favoriteLoadsIds = useAppSelector(loadboardFavoritesLoads);
    const favoriteLoads = useStableArray(favoriteLoadsIds);
    const isChecked = useMemo(() => favoriteLoads.includes(resultId), [favoriteLoads, resultId]);
    const onClick = () => {
        if (isChecked) {
            dispatch(LoadboardActions.removeFavoriteLoad({ resultId }));
            return;
        }
        dispatch(LoadboardActions.setFavoriteLoad({ resultId }));
    };

    return (
        <Stack
            direction="row"
            justifyContent="center"
            alignItems="center"
        >
            <IconButton
                size="small"
                onClick={onClick}
            >
                {isChecked ? <FilledFavoriteIcon /> : <FavoriteIcon />}
            </IconButton>
        </Stack>
    );
}

export default memo(FavoriteLoadCell);
