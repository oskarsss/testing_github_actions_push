import IntegrationProviderGrpcService from '@/@grpcServices/services/intergrations.service';
import { useTruckLocation } from '@/store/streams/events/hooks';
import LocationComponents from '@/@core/ui-kits/loads/loads-map/controllers/load-info-controller/components/location-info/LocationComponents';
import { createSvgIcon } from '@mui/material';
import isOnline from '@/utils/is-online';
import { getLocationColor } from '@/@core/ui-kits/loads/loads-map/controllers/load-info-controller/utils';

const TruckIcon = createSvgIcon(
    <svg
        width="14"
        height="14"
        viewBox="0 0 14 14"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
    >
        <path
            d="M9.54603 3.9375V4.89125C9.54603 5.06066 9.61329 5.22313 9.7331 5.34292C9.85286 5.46271 10.0153 5.53001 10.1848 5.53001H11.8122L11.0028 3.60938H9.8654C9.8227 3.60936 9.78041 3.6179 9.7411 3.63449C9.70178 3.65109 9.6662 3.6754 9.63639 3.70599C9.60664 3.73658 9.5833 3.77282 9.56773 3.81259C9.55221 3.85236 9.5448 3.89483 9.54603 3.9375Z"
            fill="#596372"
        />
        <path
            d="M13.2387 7.29971L12.1231 6.18409C12.1217 6.17394 12.1217 6.16361 12.1231 6.15346H10.185C9.8473 6.15346 9.52349 6.01929 9.28474 5.78056C9.04598 5.5418 8.91187 5.21797 8.91187 4.88032V3.93532C8.91012 3.80917 8.93351 3.68395 8.9807 3.56695C9.02789 3.44997 9.09795 3.34356 9.18674 3.25394C9.27558 3.16433 9.38134 3.09332 9.49789 3.04505C9.61444 2.99678 9.73944 2.97222 9.86562 2.97281H10.7406L10.3031 1.96219C10.2696 1.88311 10.2136 1.81564 10.142 1.76818C10.0704 1.72072 9.98649 1.69538 9.90062 1.69531H7.21874C7.16105 1.69643 7.10604 1.71984 7.06527 1.76062C7.02449 1.8014 7.0011 1.85639 6.99999 1.91406V7.72409C6.99999 7.78207 6.97695 7.83772 6.93589 7.87879C6.89488 7.91979 6.83923 7.94284 6.78124 7.94284H0.875C0.816982 7.94284 0.761343 7.96588 0.720318 8.00689C0.679298 8.04795 0.65625 8.10354 0.65625 8.16159V10.3928C0.65625 10.4509 0.679298 10.5065 0.720318 10.5475C0.761343 10.5885 0.816982 10.6116 0.875 10.6116H1.31249C1.30101 10.3893 1.33487 10.167 1.41202 9.95819C1.48917 9.74942 1.60799 9.55855 1.76127 9.39714C1.91454 9.23574 2.09905 9.10723 2.30357 9.01938C2.50809 8.93159 2.72835 8.88626 2.95093 8.88626C3.17351 8.88626 3.39376 8.93159 3.59829 9.01938C3.8028 9.10723 3.98732 9.23574 4.14059 9.39714C4.29386 9.55855 4.41269 9.74942 4.48984 9.95819C4.56699 10.167 4.60085 10.3893 4.58936 10.6116H4.81248C4.81248 10.1776 4.98488 9.76144 5.29173 9.4546C5.59858 9.14771 6.01474 8.97534 6.44874 8.97534C6.88269 8.97534 7.29889 9.14771 7.60573 9.4546C7.91256 9.76144 8.08499 10.1776 8.08499 10.6116H9.1875C9.1875 10.1776 9.35987 9.76144 9.6667 9.4546C9.97359 9.14771 10.3897 8.97534 10.8237 8.97534C11.2577 8.97534 11.6738 9.14771 11.9807 9.4546C12.2876 9.76144 12.4599 10.1776 12.4599 10.6116H12.9281C13.0441 10.6116 13.1554 10.5655 13.2375 10.4834C13.3195 10.4014 13.3656 10.2901 13.3656 10.1741V7.61034C13.3659 7.55276 13.3549 7.49565 13.3331 7.44239C13.3113 7.38908 13.2792 7.3406 13.2387 7.29971Z"
            fill="#596372"
        />
        <path
            d="M2.90508 9.57812C2.7697 9.57812 2.63565 9.60484 2.51063 9.65682C2.3856 9.70873 2.27207 9.78486 2.17654 9.88082C2.08101 9.97672 2.00537 10.0906 1.95396 10.2158C1.90255 10.3411 1.87638 10.4752 1.87696 10.6106C1.89402 10.8723 2.00999 11.1177 2.20134 11.2969C2.39268 11.4762 2.64507 11.576 2.90727 11.576C3.16948 11.576 3.42186 11.4762 3.61321 11.2969C3.80455 11.1177 3.92052 10.8723 3.93758 10.6106C3.93758 10.4751 3.91088 10.3408 3.85899 10.2155C3.8071 10.0902 3.73105 9.97643 3.63517 9.88053C3.53929 9.78468 3.42547 9.70862 3.3002 9.6567C3.17494 9.60484 3.04067 9.57812 2.90508 9.57812ZM3.43446 10.6106C3.42246 10.7422 3.36173 10.8644 3.26419 10.9535C3.16665 11.0426 3.03935 11.0919 2.90727 11.0919C2.7752 11.0919 2.64789 11.0426 2.55035 10.9535C2.45281 10.8644 2.39208 10.7422 2.38009 10.6106C2.3734 10.5374 2.38207 10.4635 2.40553 10.3938C2.42898 10.324 2.46672 10.26 2.51632 10.2056C2.56593 10.1513 2.62631 10.1079 2.69362 10.0782C2.76093 10.0485 2.8337 10.0332 2.90727 10.0332C2.98084 10.0332 3.0536 10.0485 3.12092 10.0782C3.18823 10.1079 3.24862 10.1513 3.29823 10.2056C3.34783 10.26 3.38556 10.324 3.40902 10.3938C3.43247 10.4635 3.44114 10.5374 3.43446 10.6106Z"
            fill="#596372"
        />
        <path
            d="M6.44853 9.57812C6.17465 9.57812 5.91204 9.68692 5.71843 9.88053C5.5248 10.0742 5.41602 10.3368 5.41602 10.6106C5.41602 10.8844 5.5248 11.1471 5.71843 11.3407C5.91204 11.5343 6.17465 11.6431 6.44853 11.6431C6.72234 11.6431 6.98496 11.5343 7.17857 11.3407C7.37224 11.1471 7.48103 10.8844 7.48103 10.6106C7.48103 10.4751 7.45431 10.3408 7.40239 10.2155C7.35054 10.0902 7.27447 9.97643 7.17857 9.88053C7.08273 9.78468 6.96892 9.70862 6.84362 9.6567C6.71838 9.60484 6.58409 9.57812 6.44853 9.57812ZM6.99978 10.6106C6.99978 10.751 6.94401 10.8857 6.84473 10.985C6.74544 11.0842 6.61081 11.14 6.4704 11.14C6.32999 11.14 6.19536 11.0842 6.09608 10.985C5.99679 10.8857 5.94103 10.751 5.94103 10.6106C5.94103 10.4702 5.99679 10.3356 6.09608 10.2363C6.19536 10.137 6.32999 10.0813 6.4704 10.0813C6.61081 10.0813 6.74544 10.137 6.84473 10.2363C6.94401 10.3356 6.99978 10.4702 6.99978 10.6106Z"
            fill="#596372"
        />
        <path
            d="M10.8235 9.57812C10.5496 9.57812 10.287 9.68692 10.0934 9.88053C9.89975 10.0742 9.79102 10.3368 9.79102 10.6106C9.79102 10.8844 9.89975 11.1471 10.0934 11.3407C10.287 11.5343 10.5496 11.6431 10.8235 11.6431C11.0973 11.6431 11.3599 11.5343 11.5536 11.3407C11.7472 11.1471 11.856 10.8844 11.856 10.6106C11.856 10.3368 11.7472 10.0742 11.5536 9.88053C11.3599 9.68692 11.0973 9.57812 10.8235 9.57812ZM11.3747 10.6106C11.3747 10.751 11.3189 10.8857 11.2197 10.985C11.1204 11.0842 10.9857 11.14 10.8453 11.14C10.705 11.14 10.5703 11.0842 10.471 10.985C10.3718 10.8857 10.316 10.751 10.316 10.6106C10.316 10.4702 10.3718 10.3356 10.471 10.2363C10.5703 10.137 10.705 10.0813 10.8453 10.0813C10.9857 10.0813 11.1204 10.137 11.2197 10.2363C11.3189 10.3356 11.3747 10.4702 11.3747 10.6106Z"
            fill="#596372"
        />
        <path
            d="M3.49829 3.82079C3.72332 3.82079 3.9391 3.91019 4.09816 4.06931C4.25722 4.22843 4.34653 4.44424 4.34644 4.66928C4.34635 4.89431 4.25688 5.11013 4.0977 5.26925C3.93851 5.42837 3.72267 5.51776 3.49763 5.51776C3.2726 5.51776 3.05682 5.42837 2.89776 5.26925C2.7387 5.11013 2.64939 4.89431 2.64948 4.66928C2.64957 4.44424 2.73904 4.22843 2.89823 4.06931C3.05741 3.91019 3.27326 3.82079 3.49829 3.82079ZM1.5994 4.8814H1.16455L1.16472 4.45716H1.59957C1.69536 3.57261 2.402 2.86624 3.28658 2.77079L3.28675 2.33594H3.71099L3.71082 2.77079C4.59532 2.86624 5.30141 3.57261 5.39652 4.45716H5.83137L5.83121 4.8814H5.39636C5.30056 5.76595 4.59393 6.4723 3.70935 6.56779L3.70918 7.0026H3.28494L3.2851 6.56779C2.4006 6.4723 1.69451 5.76595 1.5994 4.8814ZM3.49854 3.18442C3.10473 3.18442 2.727 3.34086 2.44843 3.61933C2.16986 3.8978 2.01327 4.27547 2.01312 4.66928C2.01296 5.06308 2.16925 5.44076 2.44761 5.71923C2.72596 5.9977 3.10358 6.15415 3.49738 6.15415C3.89119 6.15415 4.26893 5.9977 4.5475 5.71923C4.82607 5.44076 4.98265 5.06308 4.98281 4.66928C4.98296 4.27547 4.82666 3.8978 4.54831 3.61933C4.26995 3.34086 3.89234 3.18442 3.49854 3.18442Z"
            fill="#596372"
        />
    </svg>,
    'TruckIcon'
);

type Props = {
    truck_id: string;
    flyToPoint: (lon: number, lat: number, zoom: number) => void;
};

export function LocationTruckController({
    truck_id,
    flyToPoint
}: Props) {
    const { data } = IntegrationProviderGrpcService.useGetIntegrationProvidersQuery({});
    const truck_location = useTruckLocation(truck_id);
    const provider = data?.integrationProviders.find(
        (provider) => provider.id === truck_location?.integrationProviderId
    );

    const is_online = isOnline(truck_location?.timestamp);
    const locationColor = getLocationColor(truck_location, is_online);

    const onClick = () => {
        flyToPoint(truck_location?.lon, truck_location?.lat, 15);
    };

    return (
        <LocationComponents.Row>
            <LocationComponents.IconContainer>
                <TruckIcon />
            </LocationComponents.IconContainer>
            <LocationComponents.TitleColumn>
                {provider ? (
                    <LocationComponents.ProviderLogo
                        light_logo_url={provider.lightLogoUrl}
                        dark_logo_url={provider.darkLogoUrl}
                        provider_name={provider.name}
                    />
                ) : (
                    '-'
                )}
            </LocationComponents.TitleColumn>
            <LocationComponents.Location
                onClick={onClick}
                disabled={!truck_location?.lon || !truck_location?.lat}
                color={locationColor}
                location={truck_location?.address}
            />
            <LocationComponents.Time time={truck_location?.timestamp} />
        </LocationComponents.Row>
    );
}
